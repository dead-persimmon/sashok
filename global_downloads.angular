<!doctype html>
<html lang='en' ng-app='_app'>
<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <script src='http://ajax.googleapis.com/ajax/libs/angularjs/1.2.18/angular.min.js'></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <title>ATL</title>
</head>
<body ng-controller='_controller'>
    <script>
        var _app = angular.module('_app', []);

        _app.controller('_controller', ['$scope', '$http', function ($scope, $http) {
            $scope.data = [];
            
            $scope.orderByField = 'downloads';
            
            ($scope.pullData = function () {
                $http.get('global_downloads')
                    .success(function (data, status, headers, config) {
                        $scope.data = $scope.data.concat(data);
                        console.log(data);
                    })
                    .error(function (data, status, headers, config) {
                        console.log('Request failed.');
                        console.log(arguments);
                    });
            })();
        }]);
    </script>
    
    <div class='container'>
        <table class='table'>
            <thead>
                <tr>
                    <th><input ng-model='orderByField' type="radio" name='orderByRadios' value="title"> Title</th>
                    <th><input ng-model='orderByField' type="radio" name='orderByRadios' value="num_files"> Total # of files</th>
                    <th><input ng-model='orderByField' type="radio" name='orderByRadios' value="downloads_per_file"> Avg. # of downloads per file</th>
                    <th><input ng-model='orderByField' type="radio" name='orderByRadios' value="downloads"> Total # of downloads</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat='group in data | orderBy:orderByField:true'>
                    <td>{{ group.title }} <small>[{{ group.most_recent_file }} days]</small></td>
                    <td>{{ group.num_files | number }}</td>
                    <td>{{ group.downloads_per_file | number }}</td>
                    <td>{{ group.downloads | number }}</td>
                </tr>
            </tbody>
        </table>
    </div>
</body>
</html>